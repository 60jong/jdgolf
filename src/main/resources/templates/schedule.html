<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Reservation Schedule</title>
  <link rel="stylesheet" th:href="@{/css/schedule.css}">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="header">
  <a th:href="@{/}">
    <img th:src="@{/img/jdgolf_logo.jpg}" alt="JD Golf Logo" class="logo">
  </a>
</div>
<div class="reservation-schedule-title">
  <b>ì˜ˆì•½ ìŠ¤ì¼€ì¥´ ê´€ë¦¬</b>
</div>
<div class="date-time-selector">
  <label for="selected-date">ğŸ“… ë‚ ì§œì™€ ì‹œê°„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”</label>
  <input type="date" id="selected-date" class="date-button">
</div>

<div class="schedule" id="schedule-container">
  <!-- ì˜ˆì•½ ë‚´ì—­ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ê³³ -->
</div>

<script>
  $(document).ready(function() {
    $('#selected-date').change(function() {
      const selectedDate = $(this).val();

      if (selectedDate) {
        $.ajax({
          url: '/reservations/check/schedule',
          method: 'GET',
          data: { date: selectedDate },
          success: function(totalPracticeTeeStatuses) {
            $('#schedule-container').empty();

            totalPracticeTeeStatuses.forEach(function(status) {
              const timeLabel = `<div class="time-label">${status.time}</div>`;

              // PRACTICE ë°•ìŠ¤ ì„¹ì…˜
              let practiceTeesHtml = '<div class="tee-section"><div class="section-label">Practice</div><div class="practiceTee-container">';
              status.teeStatuses.forEach(function(teeStatus) {
                if (teeStatus.reservationType === "PRACTICE" || teeStatus.reservationType === "LESSON") {
                  const teeClass = teeStatus.reserved ? "unavailable" : "available";
                  const memberName = teeStatus.reserved ? teeStatus.memberName : '';
                  practiceTeesHtml += `<div class="practiceTee ${teeClass} practice-box">${memberName || ''}</div>`;
                }
              });
              practiceTeesHtml += '</div></div>';

              // SCREEN ë°•ìŠ¤ ì„¹ì…˜
              let screenTeesHtml = '<div class="tee-section"><div class="section-label">Screen</div><div class="practiceTee-container">';
              status.teeStatuses.forEach(function(teeStatus) {
                if (teeStatus.reservationType === "SCREEN") {
                  const teeClass = teeStatus.reserved ? "unavailable" : "available";
                  const memberName = teeStatus.reserved ? teeStatus.memberName : '';
                  screenTeesHtml += `<div class="practiceTee ${teeClass} screen-box">${memberName || ''}</div>`;
                }
              });
              screenTeesHtml += '</div></div>';

              $('#schedule-container').append(`
                <div class="time-slot">
                  ${timeLabel}
                  ${practiceTeesHtml}
                  ${screenTeesHtml}
                </div>
              `);
            });
          }
        });
      }
    });
  });
</script>
</body>
</html>
