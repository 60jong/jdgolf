<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ë ˆìŠ¨ ì˜ˆì•½</title>
  <link rel="stylesheet" th:href="@{/css/lesson_reservation.css}">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="header">
  <a th:href="@{/}">
    <img th:src="@{/img/jdgolf_logo.jpg}" alt="JD Golf Logo" class="logo">
  </a>
</div>
<div class="lesson-reservation-title">
  <b>ë ˆìŠ¨ ì˜ˆì•½</b>
</div>
<div class="instructions">
  <p class="instructions-title">ì´ìš© ë°©ë²•</p>
  <ul>
    <li><b>ë‚ ì§œ</b> -> <b>ì‹œê°„</b> ìˆœì„œë¡œ ì„ íƒ í›„ <b>ì˜ˆì•½ ê°€ëŠ¥í•œ íƒ€ì„ ë²ˆí˜¸ë¥¼ ì„ íƒ</b>í•˜ë©´ ë ˆìŠ¨ ì˜ˆì•½ì´ ì‹ ì²­ë©ë‹ˆë‹¤.</li>
    <li>ë ˆìŠ¨ ì˜ˆì•½ ì‹œ, ê¸°ë³¸ <b>60ë¶„</b>ì´ ì˜ˆì•½ ë©ë‹ˆë‹¤. (<b>ë ˆìŠ¨ 30ë¶„</b> + ë ˆìŠ¨ í›„ <b>íƒ€ì„ 30ë¶„</b>)</li>
    <li>ë ˆìŠ¨ í›„ íƒ€ì„ ì´ìš© ì‹œ <b>íƒ€ì„ ì´ë™</b>ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  </ul>
</div>

<div class="status-info">
  <div class="lesson-status-info" style="display: none;">
    <span>ë‹¤ë¥¸ íšŒì›ì˜ ë ˆìŠ¨ì´ ìˆëŠ” ì‹œê°„ëŒ€ì…ë‹ˆë‹¤.</span>
  </div>
</div>

<!-- ì„ íƒí•œ ë‚ ì§œì™€ ì‹œê°„ í‘œì‹œ -->
<div id="selected-datetime" style="display: none; font-size: 18px; margin-top: 20px; color: #F6B82F;">
</div>

<!-- íƒ€ì„ ìƒíƒœ í‘œì‹œ ì˜ì—­ -->
<div class="schedule" id="schedule-container" style="display: none;">

  <!-- ì„¤ëª… í‘œì‹œ ì˜ì—­ -->
  <div class="legend">
    <div class="available-legend">ğŸŸ¨ ë¹ˆ íƒ€ì„</div>
    <div class="unavailable-legend">â¬œ ì˜ˆì•½ëœ íƒ€ì„</div>
  </div>

  <div class="tee-section">
    <div class="practiceTee-container" id="practiceTee-container">
      <!-- íƒ€ì„ ìƒíƒœê°€ ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ì˜ˆì • -->
    </div>
  </div>
</div>

<!-- ë‚ ì§œ ë° ì‹œê°„ ì„ íƒ ì˜ì—­ -->
<div class="date-time-selector">
  <label for="selected-date">ğŸ“… ë‚ ì§œì™€ ì‹œê°„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”</label>
  <input type="date" id="selected-date" class="date-button">
  <div class="time-selector" id="time-selector">
    <button class="time-button" data-time="11:00">11:00</button>
    <button class="time-button" data-time="11:30">11:30</button>
    <button class="time-button" data-time="12:00">12:00</button>
    <button class="time-button" data-time="12:30">12:30</button>
    <!-- í•„ìš”í•œ ì‹œê°„ëŒ€ ì¶”ê°€ -->
  </div>
</div>

<script>
  $(document).ready(function() {
    $('.time-button').click(function() {
      // ê¸°ì¡´ ì„ íƒëœ ë²„íŠ¼ì˜ selected í´ë˜ìŠ¤ë¥¼ ì œê±°
      $('.time-button').removeClass('selected');
      // í´ë¦­í•œ ë²„íŠ¼ì— selected í´ë˜ìŠ¤ ì¶”ê°€
      $(this).addClass('selected');

      const selectedDate = $('#selected-date').val();
      const selectedTime = $(this).data('time');

      if (!selectedDate) {
        alert('ë‚ ì§œë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.');
        return;
      }

      // ì„ íƒí•œ ë‚ ì§œì™€ ì‹œê°„ í‘œì‹œ
      $('#selected-datetime').text(`${selectedDate} - ${selectedTime}`).show();

      // ë ˆìŠ¨ ì—¬ë¶€ í™•ì¸
      $.ajax({
        url: '/reservations/check/lesson',
        method: 'GET',
        data: { date: selectedDate, time: selectedTime },
        success: function(hasLesson) {
          if (hasLesson) {
            $('.lesson-status-info').show();
            $('#schedule-container').hide();
          } else {
            $('.lesson-status-info').hide();
            loadPracticeTeeStatus(selectedDate, selectedTime);
          }
        }
      });
    });

    // Practice Tee ìƒíƒœ ë¡œë“œ í•¨ìˆ˜
    function loadPracticeTeeStatus(date, time) {
      $.ajax({
        url: '/reservations/check/practicetee',
        method: 'GET',
        data: { date: date, time: time },
        success: function(response) {
          $('#schedule-container').show();
          $('#practiceTee-container').empty();

          const teeStatuses = response.teeStatuses;
          console.log(teeStatuses);

          teeStatuses.forEach(function(teeStatus, index) {
            const teeClass = teeStatus.reserved ? "unavailable" : "available";
            const displayText = index + 1; // í•­ìƒ íƒ€ì„ ë²ˆí˜¸ í‘œì‹œ

            const practiceTeeDiv = $(`<div class="practiceTee ${teeClass}">${displayText}</div>`);

            if (!teeStatus.reserved) {
              // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
              practiceTeeDiv.click(function() {
                if (confirm(`${date} - ${time} ${displayText}ë²ˆ íƒ€ì„ì„ ì˜ˆì•½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                  // ì˜ˆì•½ POST ìš”ì²­
                  $.ajax({
                    url: '/reservations/lesson',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ date: date, time: time, teeId: parseInt(displayText) }),
                    success: function(response) {
                      alert('ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                      // í•„ìš”ì— ë”°ë¼ ì¶”ê°€ì ì¸ í–‰ë™
                    },
                    error: function() {
                      alert('ì˜ˆì•½ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
                    }
                  });
                }
              });
            }

            $('#practiceTee-container').append(practiceTeeDiv);
          });
        }
      });
    }
  });
</script>
</body>
</html>
